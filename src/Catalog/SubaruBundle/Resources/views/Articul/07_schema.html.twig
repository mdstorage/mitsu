{% extends 'CatalogCommonBundle:Catalog:07_schema.html.twig' %}
{% use 'CatalogSubaruBundle::subaru.base.html.twig' %}
{% block breadcrumbs %}
    <a href="{% if  app.request.get('token') %} {{ path('articul_subaru_find_token', parameters) }} {% else %} {{ path('articul_subaru_find') }} {% endif %}">Выбрать регион, модель, модификацию</a> /
    <a href="{{ path('articul_subaru_groups', parameters) }}">Выбрать группу запчастей</a> /
    <a href="{{ path('articul_subaru_subgroups', parameters) }}">Выбрать подгруппу запчастей</a> /
    <a href="{{ path('articul_subaru_schemas', parameters) }}">Выбрать схему</a> / Выбрать запчасть
{% endblock breadcrumbs %}

{% block refGroupsHead %}<h4>Связанные изображения</h4>{% endblock refGroupsHead %}

{% block image %}
    <img src="{{ asset('bundles/catalogsubaru/Subaru_Images/'~oContainer.getActiveSchema.getOption(constant('Catalog\\CommonBundle\\Components\\Constants::CD'))~'/'~oContainer.getActiveSchema.getCode~'.png') }}" width="900" usemap="#{{ oContainer.getActiveSchema.getCode }}" alt="{{ oContainer.getActiveSchema.getRuname }}"/>
{% endblock image %}

{% block pncClick %}

    $("#articul_for_pnc{{ pnc.getCode }}").toggleClass("hidden");
    $("#pnc_{{ pnc.getCode }}").toggleClass("glyphicon-plus");

    $("#articul_for_pnc{{ pnc.getCode }}").html('<img src={{ asset("bundles/catalogcommon/images/loading.gif") }} height="15px" />');
    $.ajax({
    type:   'POST',
    async:  false,
    url:    "{{ path('articul_subaru_articuls') }}",
    data:   {
    regionCode: '{{ oContainer.getActiveRegion.getCode }}',
    modelCode: '{{ oContainer.getActiveModel.getCode }}',
    modificationCode: '{{ oContainer.getActiveModification.getCode }}',
    complectationCode: '{{ oContainer.getActiveComplectation.getCode }}',
    cd: '{{ oContainer.getActiveSchema.getOption(constant('Catalog\\CommonBundle\\Components\\Constants::CD')) }}',
    subGroupCode: '{{ parameters.subGroupCode }}',
    articul: '{{ parameters.articul }}',
    token: '{{ parameters.token }}',
    pncCode: '{{ pnc.getCode }}'
    },
    success: function(data) {
    $("#articul_for_pnc{{ pnc.getCode }}").html(data);
    }
    });

    $.scrollTo("#pnc_{{ pnc.getCode }}", {duration:1500});


    $("#pnc_{{ pnc.getCode }}").toggleClass("glyphicon-minus");
    $("#pnc_{{ pnc.getCode }}").toggleClass("small btn-default");

{% endblock pncClick %}




{% block commonArticulPath %}{{ parameters.redirectAdress|replace({ '{article}': commonArticul.getCode }) }}{% endblock commonArticulPath %}
{% block subGroupPath %}{{ path('catalog_subaru_group', parameters|merge({'subGroupCode': refGroup.getCode})) }}{% endblock subGroupPath %}
{% block pncScript %}
    {% if pnc.isActive %}
        <script>
            $(document).ready(function(){
                {{ block('pncClick') }}
            });
        </script>

    {% endif %}
    {{ parent() }}
{% endblock pncScript %}
{% set a = [] %}
{% for pnc in oContainer.getActiveSchema.getPncs %}
    {% if pnc.isActive %}
        {% set a = a|merge([pnc.getCode]) %}
    {% endif %}
{% endfor %}
{% block activeLabel %}{{ a|join(',') }}{% endblock activeLabel %}