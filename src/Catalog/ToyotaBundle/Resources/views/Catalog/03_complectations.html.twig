{% extends 'CatalogCommonBundle:Catalog:03_complectations.html.twig' %}
{% use 'CatalogToyotaBundle::toyota.base.html.twig' %}
{% block breadcrumbs %}
   <a href="{{ path('catalog_toyota') }}">Регион, модель, модификация ({{ oContainer.getActiveRegion.getRuname }},
   {{ oContainer.getActiveModel.getRuname }}, {{ oContainer.getActiveModification.getRuname }})</a> / Комплектация
{% endblock breadcrumbs %}



{% block body %}
    {% block head %}<h3>Выбрать комплектацию:</h3>{% endblock head %}
    {% block complectations %}





        <div class="row">

            <div class="complectations">

                <div class="form-group control-group">
                    <form action="{{ path('catalog_toyota_groups', parameters|merge({'complectationCode': '1'})) }}">
                        <div class="col-sm-4">   {{ form_widget(form) }}


                            <br>
                            <input type="submit" class="btn btn-primary" value="Далее" />
                        </div>
                    </form>
                </div>


            </div>
        </div>



        <script>


            $('select.form-control').on('change', function(){

                filter('#'.concat($(this).attr('id')));

            });


            function filter(selector) {
                $(selector).each(function() {
                    if ($(selector).val() == '1') location.reload();
                    $.ajax({
                        type:   'POST',
                        async:  false,
                        url:    "{{ path('catalog_toyota_complectation_korobka') }}",
                        data:   { priznak_agregata: selector.substr(-2) ,engine: $(selector).val(), modificationCode: '{{ oContainer.getActiveModification.getCode }}',
                            regionCode: '{{ oContainer.getActiveRegion.getCode }}',
                            modelCode: '{{ oContainer.getActiveModel.getCode }}'},
                        success: function(data){document.write(data);

                            if (selector.substr(-2) === 'EN')
                                var selector1 = selector.substr(0, selector.indexOf(selector.substr(-2))).concat('KP');

                            if (selector.substr(-2) === 'KP')
                                selector1 = selector.substr(0, selector.indexOf(selector.substr(-2))).concat('EN');


                            var objSel = document.getElementById(selector1.substr(1,selector1.length));

                            var optSel = objSel.options[objSel.selectedIndex].value;

                            $(selector1).empty();

                            $.each(JSON.parse(data), function(key, value) {
                                objSel.options[objSel.options.length] = new Option(value, key, true);

                            });

                            for (var i = objSel.options.length-1; i >= 0; i--)
                            {
                                if (objSel.options[i].value == optSel)

                                    objSel.options[i].selected = true;
                            }

                        }

                    });
                });
            }



        </script>


        <div class="row">
            <div id="content"></div>
        </div>


        {#
                        {% for complectation in oContainer.getActiveModification.getComplectations %}
                            {% block vinScript %}
                                <script>


                                    $(document).ready(function(){
                                        var count = $('.radio').size();
                                        if (count == 1) {$("#optionsRadios").prop("checked", true);
                                            $("#optionsRadios").trigger('change');
                                        }
                                        $('#optionsRadiosM').trigger('change');

                                    });
                                </script>

                            {% endblock vinScript %}
                        {% endfor %}

                                            <input type="button" class="btn btn-info" value="Удалить статью" id="vin-button{{ post.id }}"/>
                                       <div id="vin-result"></div>


                                    #}
    {% endblock complectations %}
{% endblock body %}
{#-{% block body %}
    {% block head %}<h3>Выбрать комплектацию:</h3>{% endblock head %}
   
    {% block complectations %}
    <div class="row">
    
        <div class="complectations"><hr />
        <div class="row">
        
        
        <div class="form-group">
        
        <div class="col-lg-5">
               
        <input name="filter-query" class="form-control" value="" id="filter-query" onclick="this.value='';"
        type="text" placeholder="Введите любой признак для фильтрации параметров"/>
        </div>
                
        <a href="#" class="btn btn-default" onclick="$('#filter-query').val(''); $('#filter-query1').val(''); $('#filter-query2').val('');
        repeatact();return false">Показать все</a>
        <input name="filter-query1" class="form-control" value="" id="filter-query1" type="text" style="display:none;"/>
        <input name="filter-query2" class="form-control" value="" id="filter-query2" type="text" style="display:none;"/>
        
        </div>
        
        
        </div>
        
       
                       <div class="row">
             {% if oContainer.getActiveModification.getComplectations|first.getOption('trans') %}
                       <div class="col-lg-4">
                            <b>Трансмиссия:</b>
                  {% for trans in oContainer.getActiveModification.getComplectations|first.getOption('trans') %}
                                          		
                      <a href="#" class="btn btn-default" onclick="$('#filter-query').val('{{ trans }}');
                      $('#filter-query2').val($('#filter-query').val());
                      repeatact();return false">{{ trans }}</a>
                      
                  {% endfor %}
                      </div>
              {% endif %}

                           {#  {% if oContainer.getActiveModification.getComplectations|first.getOption('option1') %}
                                    <div class="col-lg-4">
                                     <b>Положение руля:</b>
                                {% for role in oContainer.getActiveModification.getComplectations|first.getOption('option1') %}

                                    <a href="#" class="btn btn-default" onclick="$('#filter-query1').val('{{ role }}');
                                    $('#filter-query2').val($('#filter-query').val().concat('+',$('#filter-query1').val()));
                                    repeatact();return false">{{ role }}</a>

                                {% endfor %}
                                    </div>
                            {% endif %}
                      </div><hr />
                      <br/>
                      
            {% for complectation in oContainer.getActiveModification.getComplectations %}
                {% block complectationItem %}
            <div style=" height: 250px; " class="col-lg-3">
           
                             <a href="{{ path('catalog_toyota_groups', parameters|merge({'complectationCode': complectation.getCode})) }}">

                                 <b>{{ complectation.getRuname}}<br/>
        
        {{ complectation.getOption('FROMDATE')|toyota_date_convertor }} - {{ complectation.getOption('UPTODATE')|toyota_date_convertor }} </b>
      </a><br/>


                    {{ complectation.getOption('OPTION1')|replace({' 1': ''})}}


                <br/>

                {% if complectation.getOption('OPTION2') %}
                    {{ complectation.getOption('OPTION2')}}<br/>
                {% endif %}

                {% if complectation.getOption('OPTION3') %}
                {{ complectation.getOption('OPTION3')}}<br/>
                {% endif %}
                {% if  complectation.getOption('OPTION4') %}
                    {{ complectation.getOption('OPTION4')}}<br/>
                {% endif %}
                {% if  complectation.getOption('OPTION5') %}
                    {{ complectation.getOption('OPTION5')}}<br/>
                {% endif %}
                {% if complectation.getOption('OPTION6') %}
                    {{ complectation.getOption('OPTION6')}}<br/>
                {% endif %}
                {% if  complectation.getOption('OPTION7') %}
                    {{ complectation.getOption('OPTION7')}}<br/>
                {% endif %}
                {% if complectation.getOption('OPTION8') %}
                    {{ complectation.getOption('OPTION8')}}<br/>
                {% endif %}

      <hr/>
                           
                </div>
                {% endblock complectationItem %}
            {% endfor %}
        </div>
        </div> 
    {% endblock complectations %}


 <script>
 
                $(document).ready(function() {
	$('#filter-search').show();
	
	$('#filter-query').keyup(function(event){
		
		if (event.keyCode == 27 || $(this).val() == '') {
			$(this).val('');
			$('.col-lg-3').removeClass('visible').show().addClass('visible');
		}
		else {
			filter('.col-lg-3', $(this).val());
		}
	});
	$('#filter-query2').keyup(function(event){
		
		if (event.keyCode == 27 || $(this).val() == '') {
			$(this).val('');
			$('.col-lg-3').removeClass('visible').show().addClass('visible');
		}
		else {
			filter('.col-lg-3', $(this).val());
		}
	});
});
function filter(selector, query) {
	query =	$.trim(query);
	$(selector).each(function() {
		($(this).text().search(new RegExp(query, "i")) < 0)
		? $(this).hide().removeClass('visible') : $(this).show().addClass('visible');
	});
}
function repeatact(){
	filter('.col-lg-3', $('#filter-query2').val());
}

</script>
  
{% endblock body %}

-#}

